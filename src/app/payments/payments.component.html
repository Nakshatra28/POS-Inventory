<!-- ================= HEADER ================= -->
<div class="flex justify-between items-center px-4">
  <div>
    <p class="text-3xl">Payments</p>
    <p class="text-xs text-gray-500 px-1">
      Track and manage customer payments
    </p>
  </div>
</div>

<!-- ================= SEARCH ================= -->
<div class="flex gap-4 px-4 mt-10 mb-6">
  <div class="flex items-center border border-white/20 w-64 py-0.5 rounded-lg px-2">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
      stroke-width="1.5" stroke="currentColor" class="size-5">
      <path stroke-linecap="round" stroke-linejoin="round"
        d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
    </svg>

    <input
      [(ngModel)]="searchText"
      (input)="searchInvoice()"
      type="search"
      placeholder="Search payment"
      class="px-2 bg-transparent outline-none w-full">
  </div>
</div>

<!-- ================= TABLE ================= -->
<div class="px-4">
<div
  class="max-h-[260px] overflow-y-auto hide-scrollbar rounded-lg border border-white/10"
  (scroll)="onScroll($event)">

    <table class="w-full text-left text-sm">

      <thead class="bg-gray-800 text-gray-300 sticky top-0"
      >
        <tr>
          <th class="py-3 px-4">Sr No</th>
          <th class="py-3 px-4">Customer</th>
          <th class="py-3 px-4">Invoice</th>
          <th class="py-3 px-4">Amount</th>
          <th class="py-3 px-4">Method</th>
          <th class="py-3 px-4">Reference</th>
          <th class="py-3 px-4">Status</th>
          <th class="py-3 px-4 text-right">Action</th>
        </tr>
      </thead>

      <tbody class="bg-[#0F172B] text-gray-200">
        <tr *ngFor="let pay of visiblePayments; let i = index"
            class="border-t border-white/10 hover:bg-white/5 transition">

          <td class="py-3 px-4">{{ i + 1 }}</td>
          <td class="py-3 px-4">{{ pay.customerName }}</td>
          <td class="py-3 px-4">{{ pay.invoiceId | slice:0:8 }}…</td>
          <td class="py-3 px-4">₹ {{ pay.amount }}</td>
          <td class="py-3 px-4 capitalize">{{ pay.method }}</td>
          <td class="py-3 px-4">{{ pay.referenceNo || '—' }}</td>

          <td class="py-3 px-4">
            <span
              class="px-2 py-1 text-xs rounded"
              [ngClass]="{
                'bg-green-600/20 text-green-400': pay.status === 'paid',
                'bg-yellow-600/20 text-yellow-400': pay.status === 'partial'
              }">
              {{ pay.status | titlecase }}
            </span>
          </td>

          <td class="py-3 px-4 text-right">
            <button
              class="text-blue-400 hover:underline text-sm"
              (click)="viewPayment(pay)">
              View
            </button>
          </td>
        </tr>

        <tr *ngIf="visiblePayments.length === 0">
          <td colspan="8" class="py-6 text-center text-gray-400">
            No payments found
          </td>
        </tr>
      </tbody>

    </table>
  </div>
</div>

<!-- ================= TOAST ================= -->
<div
  *ngIf="toastVisible"
  class="fixed top-6 right-6 z-[9999] px-5 py-3 rounded-xl shadow-2xl"
  [ngClass]="{
    'bg-[#0C1424] border border-green-500/30 text-green-400': toastType === 'success',
    'bg-[#0C1424] border border-red-500/30 text-red-400': toastType === 'error'
  }">
  {{ toastMessage }}
</div>

<!-- ================= VIEW MODAL ================= -->
<app-payment-view
  *ngIf="showViewPopup"
  [payment]="selectedPayment"
  (close)="showViewPopup = false">
</app-payment-view>
