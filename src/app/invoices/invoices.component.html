<!-- HEADER -->
<div class="flex justify-between items-center px-4">
  <div>
    <p class="text-3xl">Invoices</p>
    <p class="text-xs text-gray-500 px-1">
      Manage sales invoices and billing
    </p>
  </div>

  <button (click)="openPopup()"
    class="flex items-center gap-1 bg-blue-500 py-1.5 px-2 rounded-lg text-sm transform active:scale-95">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
      class="size-5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
    </svg>
    <p>Create Invoice</p>
  </button>
</div>

<!-- SEARCH + FILTER -->
<div class="flex gap-4 px-4 mt-10 mb-8">
  <!-- SEARCH -->
  <div>
    <div class="flex items-center border border-white/20 w-64 py-0.5 rounded-lg px-2">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
        class="size-5">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
      </svg>
      <input 
       type="search"
  [(ngModel)]="searchText"
  (input)="searchInvoice()"
  placeholder="Search"
     
      
      placeholder="Search" class="px-2 bg-transparent outline-none">
    </div>
  </div>
  <button  (click)="searchText='';searchInvoice()"
class="flex items-center gap-1 py-1 px-2 rounded-lg text-sm transform active:scale-95">
  Search
</button>

  <!-- FILTER -->
  <div class="relative inline-block">
    <button 
     (click)="toggleFilter()"
    class="flex items-center gap-1 bg-gray-700 rounded-lg px-3 py-0.5">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
        class="size-4">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z" />
      </svg>
      <p>Filter</p>
    </button>


    <!-- Dropdown -->
    <div *ngIf="showFilter" appClickOutside (outsideClick)="showFilter = false"
      class="absolute right-0 mt-2 w-24 text-xs bg-[#0F172B] border border-white/10 rounded-lg shadow-lg z-50">
      <button class="block w-full text-left px-3 py-2 hover:bg-white/5" (click)="applyStatusFilter('')">
        All
      </button>
      <button class="block w-full text-left px-3 py-2 hover:bg-white/5" (click)="applyStatusFilter('Paid')">
        Paid
      </button>
      <button class="block w-full text-left px-3 py-2 hover:bg-white/5" (click)="applyStatusFilter('Pending')">
        Unpaid
      </button>

    </div>
  </div>
</div>

<!-- INVOICE TABLE -->
<div class="px-4 mt-10">
  <div *ngIf="selectedInvoice.length > 0" class=""><button
      class="cursor-pointer transform active:scale-95 flex  items-center gap-1 mb-2" (click)="deleteInvoice()">
      <p class="text-red-600"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" class="size-4">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
        </svg>
      </p>
      <p class="text-red-600  ">Delete all</p>
    </button></div>
  <div class="overflow-x-auto rounded-2xl border border-white/10 bg-white/5">

    <table class="w-full text-left text-sm">

      <!-- TABLE HEADER -->
      <thead class="bg-white/5 text-gray-400 uppercase text-xs tracking-wider">
        <tr>
          <th class="py-3 px-4">
            <input type="checkbox" [checked]="selectAll" (change)="toggleSelectAll($event)"
              class="accent-blue-500 cursor-pointer" />
          </th>
          <th class="py-3 px-4">Sr no</th>
          <th class="py-3 px-4">Customer</th>
          <th class="py-3 px-4">Date</th>
          <th class="py-3 px-4">Due Date</th>
          <th class="py-3 px-4">Total</th>
<th class="py-3 px-4">Paid</th>
<th class="py-3 px-4">Outstanding</th>
          <th class="py-3 px-4">Status</th>
          <th class="py-3 px-4 text-right">Actions</th>
        </tr>
      </thead>

      <!-- TABLE BODY -->
     <tbody class="divide-y divide-white/10 text-gray-200 text-xs">

<tr *ngFor="let invoice of invoiceList; let i = index"
    class="hover:bg-white/5 transition duration-150">

  <!-- Checkbox -->
  <td class="py-4 px-4">
    <input
      type="checkbox"
      class="accent-blue-500 cursor-pointer"
      [checked]="selectedInvoice.includes(invoice._id)"
      (change)="toggleInvoice(invoice._id, $event)" />
  </td>

  <!-- Sr No -->
  <td class="py-4 px-4 text-gray-400">{{ i + 1 }}</td>

  <!-- Customer -->
  <td class="py-4 px-4 font-medium">
    {{ invoice.customerName }}
  </td>

  <!-- Date -->
  <td class="py-2.5 px-4 text-gray-400 whitespace-nowrap">
  {{ invoice.invoiceDate | date:'dd MMM yyyy' }}
</td>

  <!-- Due Date -->
  <td class="py-2.5  text-gray-400">
    {{ invoice.dueDate | date:'dd MMM yyyy' }}
  </td>

 <!-- Total -->
<td class="py-3 px-4 font-medium">
  ₹{{ invoice.grandTotal | number }}
</td>

<!-- Paid -->
<td class="py-3 px-4 text-green-400">
  ₹{{ invoice.paidAmount | number }}
</td>

<!-- Outstanding -->
<td class="py-3 px-4 text-orange-400">
  ₹{{ (invoice.grandTotal - invoice.paidAmount) | number }}
</td>


  <!-- Status -->
  <td class="py-4 ">
    <span
      class="inline-flex px-3 py-1 rounded-full text-xs font-medium"
      [ngClass]="{
        'bg-green-500/15 text-green-400': invoice.paymentStatus === 'paid',
        'bg-red-500/15 text-red-400': invoice.paymentStatus === 'unpaid',
        'bg-yellow-500/15 text-yellow-400': invoice.paymentStatus === 'partial'
      }">
      {{
        invoice.paymentStatus === 'partial'
          ? 'Partially Paid'
          : invoice.paymentStatus | titlecase
      }}
    </span>
  </td>

  <!-- Actions -->
  <td class="py-4 px-4">
    <div class="flex justify-end items-center gap-3">

      <button
        class="text-blue-400 hover:text-blue-300 text-sm"
        (click)="editInvoice(invoice)">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
  <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
</svg>
      </button>

      <button
        class="text-red-500 hover:text-red-400"
        (click)="deleteInvoice()">
       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
</svg>
      </button>

      <button
        (click)="openPaymentPopup(invoice)"
        [disabled]="!canAddPayment(invoice)"
        class="px-3 py-1.5 rounded-lg text-xs font-medium transition"
        [ngClass]="{
          'bg-blue-500 hover:bg-blue-600 text-white': canAddPayment(invoice),
          'bg-gray-700 text-gray-400 cursor-not-allowed': !canAddPayment(invoice)
        }"
          title="Add Payment">
        
       <svg xmlns="http://www.w3.org/2000/svg"
       class="w-4 h-4"
       fill="none"
       viewBox="0 0 24 24"
       stroke-width="1.5"
       stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round"
      d="M2.25 8.25h19.5M6 12h.008M10.5 12h.008M15 12h.008M3 6.75h18a1.5 1.5 0 011.5 1.5v9a1.5 1.5 0 01-1.5 1.5H3A1.5 1.5 0 011.5 16.5v-9A1.5 1.5 0 013 6.75z" />
  </svg>
      </button>

    </div>
  </td>

</tr>
</tbody>

    </table>
  </div>
</div>

<!-- TOAST -->
<div *ngIf="toastVisible" class="fixed top-6 right-6 z-[9999]
         bg-[#0C1424] border border-green-500/30
         text-green-400 px-5 py-3 rounded-xl
         shadow-2xl flex items-center gap-3
         animate-slide-in">

  <!-- Icon -->
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
       stroke-width="1.5" stroke="currentColor"
       class="size-6">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M9 12.75 11.25 15 15 9.75" />
  </svg>

  <span class="text-sm font-medium">
    {{ toastMessage }}
  </span>
</div>



<!-- POPUP -->
<app-invoicepopup *ngIf="openInvoicePopup" [data]="selectedInvoiceData" (invoiceCreated)="fetchInvoices()"
  (close)="closePopup()"  (toast)="openToast($event)">

</app-invoicepopup>
<app-editinvoice *ngIf="openeditInvoicePopup " 
(close)="closeEdit()"
(toast)="showToastMessage($event)"
[data]="dataToEdit">
</app-editinvoice>


<app-paymentpopup
  *ngIf="showPaymentPopup && invoiceForPayment"
  [invoiceId]="invoiceForPayment._id"
  (paymentAdded)="onPaymentAdded()"
  (close)="closePaymentPopup()">
</app-paymentpopup>